<!DOCTYPE html>
<html>
<head>
  <title>Upload File</title>
  <script src="https://cdn.tailwindcss.com"></script>
<head>
  <body class="bg-gray-100 min-h-screen p-6">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold mb-6 text-gray-800">Upload File</h2>
      <form 
          action="/upload" 
          method="post" 
          enctype="multipart/form-data"
          class="flex items-center space-x-4 mb-10"
      >
        <input type="file" name="file" class="flex-1 border rounded p-2 text-gray-800"/>
        <button type="submit" 
                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
        >Upload</button>
      </form>

      <h2 class="text-2xl font-bold mb-4 text-gray-800">Uploaded Files</h2>
      <table class="min-w-full border rounded-lg overflow-hidden">
          <thead class="bg-gray-200 text-gray-700">
              <tr>
                  <th class="py-3 px-4 text-left">File Name</th>
                  <th class="py-3 px-4 text-right">Actions</th>
              </tr>
          </thead>
          <tbody id="file-table" class="divide-y divide-gray-200"></tbody>
      </table>

      <script>
        async function deleteFile(fileName) {
          if(!confirm("Delete "+fileName+ "?")) return;
          const res = await fetch('/files/'+encodeURIComponent(fileName), {
            method: 'DELETE'
          });

          if(res.ok){
            alert("Deleted");
            location.reload();
          }else{
            alert("Error Deleting File");
          }
        }


        async function loadFiles(){
            const res = await fetch('/files');
            const files = await res.json();
            const table = document.getElementById('file-table');

            files.forEach(file => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td class="py-3 px-4">${file}</td>
                    <td class="py-3 px-4 text-right space-x-4">
                      <a href="/preview/${file}"
                        class="text-green-600 hover:underline"
                        >Preview
                      </a>
                      <button onclick="renameFile('${file}')" 
                        class="text-yellow-600 hover:text-yellow-800">
                        Rename
                      </button>
                      <a href="/files/${file}" download 
                        class="text-blue-600 hover:underline"
                        >Download
                      </a> 
                      <a href="#" onclick="deleteFile('${file}')"
                        class="text-red-600 hover:text-red-800"
                      >Delete</a>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        async function renameFile(oldName){
          const newName = prompt("Enter New Name");
          if(!newName || newName.trim() == "") return;
          const res = await fetch('/files/' + encodeURIComponent(oldName) + '?new=' + encodeURIComponent(newName), {
            method: 'PUT'
          });
          if (res.ok) {
            alert("Renamed successfully!");
            location.reload();
          } else {
            alert("Rename failed");
          }
        }

        loadFiles();
      </script>
    </div>
  </body>
</html>
